<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter
[
<!ENTITY % entities SYSTEM "entity-decl.ent">
%entities;
]>
<chapter version="5.0" xml:id="accessing.kubernetes"
 xmlns="http://docbook.org/ns/docbook"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink">
 <info>
  <title>Interacting with &kube;</title>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker></dm:bugtracker>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>
 
 <sect1 xml:id="installing.kubectl">
  <title>Installing kubectl</title>
  <tip>
    If you are using an operating system other than &sle; or &opensuse; please consult the <link xlink:href="https://kubernetes.io/docs/tasks/tools/install-kubectl/">installation instructions</link> from the &kube; project.
  </tip>
  <para>
    &kube; requires the use of <command>kubectl</command> for many tasks.
    You can perform most of these actions while logged in to an SSH session on the master node of your &productname; cluster.
  </para>
  <para>
    One key exception is the use of <command>kubectl proxy</command> this requires kubectl to be installed on your local machine to act as a proxy between the local workstation and the remote cluster.
  </para>
  
  <para>
  <screen>
  apiVersion: v1
  clusters:
  - cluster:
      certificate-authority: /etc/pki/trust/anchors/SUSE_CaaSP_CA.crt
      server: https://<replaceable>$caasp_master</replaceable>:6443
    name: default-cluster
  contexts:
  - context:
      cluster: default-cluster
      user: cluster-admin
    name: default-system
  current-context: default-system
  kind: Config
  preferences: {}
  users:
  - name: cluster-admin
    user:
      client-certificate: /etc/pki/kubectl-client-cert.crt
      client-key: /etc/pki/kubectl-client-cert.key
  </screen>
</para>
  
  <para>
    
  </para>
 </sect1>
 
 <sect1 xml:if="configuring.kubectl">
  <title>Configuring kubectl</title>
</sect1> 

 <sect1 xml:id="installing.kube.dashboard">
  <title>Installing &kube; Dashboard</title>
  
  <important>
   <title>Technology Preview</title>
   <para>
    Even though you can install and use the community &kube; dashboard,
    &productname; currently fully supports only &dashboard;.
   </para>
  </important>
  
  <itemizedlist>
   <title>Requirements</title>
   <listitem>
    <para>
     You need to have Heapster version 1.3.0 or later installed on the cluster.
    </para>
   </listitem>
   <listitem>
    <para>
     &suse; recommends Helm version 2.7.2+ and <literal>kubectl</literal> version 1.9.0+.
    </para>
   </listitem>
   <listitem>
     <para>
       kubectl needs to be installed on the local machine and configured to talk to the remote Kubernetes API (CaaSP Master node).
     </para>
   </listitem>
  </itemizedlist>
  
  <procedure>
   <title>Installation of &kube; Dashboard</title>
   <step>
    <screen>
helm install --name heapster-default --namespace=kube-system stable/heapster --version=0.2.7 --set rbac.create=true
    </screen>
   </step>
   <step>
    <screen>
helm install --namespace=kube-system --name=kubernetes-dashboard stable/kubernetes-dashboard --version=0.6.1
    </screen>
   </step>
   <step>
    <para>
     Connect to any cluster node using SSH.
    </para>
   </step>
   <step>
    <para>
     Visit <literal>http://127.0.0.1:8081/</literal> in your browser. You will
     be greeted with by a welcome page containing a dialog to configure
     authentication.
    </para>
   </step>
   <step>
    <para>
     Select <guimenu>token</guimenu> authentication. To retrieve your token,
     refer to the value in your <literal>kubeconfig</literal> file by running
     the command:
    </para>
    <screen>
grep "id-token" /path/to/kubeconfig  | awk '{print $2}'
    </screen>
   </step>
   <step>
    <para>
     On login, cluster resources and basic metrics are populated.
    </para>
   </step>
  </procedure>
  
  <procedure>
   <title>Exposing the Dashboard</title>
   <step>
    <screen>
helm upgrade kubernetes-dashboard stable/kubernetes-dashboard --set service.type=NodePort
    </screen>
   </step>
   <step>
    <para>
     Now you may visit the dashboard at
     <literal>https://<replaceable>WORKER_NODE_ADDRESS</replaceable>:<replaceable>NODE_PORT</replaceable></literal>
     in your browser from outside of your cluster.
    </para>
   </step>
  </procedure>
  
 </sect1>
</chapter>
