include::entities.adoc[]

= {productname} {productversion} Architecture Description
:doctype: book
:sectnums:
:sectnumlevels: 4
:toc: left
:toclevels: 4
:icons: font
:revdate: 2019-05-03
:imagesdir: images/
:experimental:

== Product Description

[WARNING]
====
This text needs to be reviewed
====

{productname} is a {cncf} certified Kubernetes distribution on top of {sle}.

{productname} automates the orchestration and management of containerized applications and services with powerful Kubernetes capabilities, including:

* Workload scheduling optimizes hardware utilization while taking the container requirements into account.
* Service proxies provide single IP addresses for services and distribute the load between containers.
* Application scaling up and down accommodates changing loads.
* Non-disruptive rollout/rollback of new applications and updates enables frequent changes without downtime.
* Health monitoring and management supports application self-healing and ensures application availability.

In addition, {productname} simplifies the platform operatorâ€™s experience, with everything you need to get up and running quickly, and to manage the environment effectively in production. It provides:

* A complete container execution environment, container run time (CRI-O), and container image registries (registry.suse.com).
* Application ecosystem support with {sle} container base images, and access to tools and services offered by SUSE Ready for CaaS Platform partners and the Kubernetes community.
* Enhanced datacenter integration features that enable you to plug Kubernetes into new or existing infrastructure, systems, and processes.
* End-to-End security, implemented holistically across the full stack including networking policies via Cilium, `PodSecurityPolicies` and {kube} RBAC.
* Advanced platform management that simplifies platform installation, configuration, re-configuration, monitoring, maintenance, updates, and recovery.
* Enterprise hardening including comprehensive interoperability testing, support for thousands of platforms, and world-class platform maintenance and technical support.

You can deploy {productname} onto physical servers or use it on virtual machines. After deployment, it is immediately ready to run and provides a highly-scalable cluster.

{productname} inherits benefits of SUSE Linux Enterprise and uses tools and technologies well-known to system administrators such as cloud-init, AutoYaST and Terraform.

{productname} uses the Btrfs file system with the following characteristics:

* The root file system and its snapshots are read-only.
* Sub-volumes for data sharing are read-write.
* {productname} introduces overlays of the /etc directories used by cloud-init and Salt.

For more information, including a list of the various components which make up {productname} please refer to the Release Notes on https://www.suse.com/releasenotes/.

[WARNING]
====
This diagram needs to be reviewed and recreated with more clean looking graphics
====

image::architecture-caasp-components.jpg[SUSE CaaSP Components, width=100%,pdfwidth=80%]

=== Product Release Cycle

Product releases are aligned with {sle} releases and {kube}. Major version jumps
are determined by the {sle} release cycle. Minor version jumps by the quarterly {kube} releases.
Individual maintenance updates with receive patchlevel numbering.

Versioning scheme: `x.y.z`

* x - Base OS version
* y - Kubernetes version
* z - Patchlevel (incl. new features !)

[%autowidth.stretch]
|===
|Version |Base OS |{kube} version |Patchlevel

|4.0.0
|{sle} 15 SP1
^|1.15
^|0

|4.0.1
|{sle} 15 SP1
^|1.15
^|1

|...
|
|
|

|4.1.0
|{sle} 15 SP1
^|1.16
^|0

|...
|
|
|

|5.0.0
|{sle} 15 SP2
^|tbd
^|0
|===


== Supported Platforms

* SUSE OpenStack Cloud 8
* VMWare ESXi 6.0.0 Update 3
* Bare Metal
** KVM
** x86_64

Any other SLE 15 SP1 supported platform.

=== Public Cloud

* Google Kubernetes Engine (GKE)
* Microsoft Azure (Azure)
* Amazon Web Services (AWS)

== Deployment Scenarios

=== Testing / POC

* testing / POC scenario
* single master
* 1 master
* 2 workers

=== Default Deployment

* default scenario
** high availability
** multi master
*** 1 Load Balancer
*** 3 Master
*** 4 Workers
** Requires:
*** persistent IP addresses
*** NTP server provided on the host network.
*** DNS entry that resolves all the master nodes.
*** load balancer to expose the API servers on the master nodes.
*** LDAP server or OIDC provider (Active Directory, GitLab, GitHub etc.)
*** Alternatively: Containerized LDAP server in the cluster

* (Optional) "Infrastructure node"
** Local RMT server to synchronize RPMs
** Local mirror of the SUSE container registry (registry.suse.com)
** Local mirror of the SUSE helm chart repository

=== Air Gapped Deployment

* air gapped
** registry mirror
** package repository mirror

== The {productname} stack

Almost all components run in containers themselves.

Namespaces used by default components

=== Base Operating System

* base OS
** SLE 15 SP1
** kernel ?
** file system
** snapshots?
** special modules
*** vxlan
* update cycle and method
** update channels
* upgrade method and cycle
* migration

==== Software Management
** extension to base OS image
** software distribution channels
** packages
** container ecosystem
*** helm
*** SUSE container registry

include::architecture-updates.adoc[leveloffset=+2]

=== Software Versions

used software components and libraries

[options="header"]
|===
^|Component ^|URL ^|Version

|image:logos/kubernetes.png[Kubernetes,width=200,height=70]
|link:https://kubernetes.io/[]
^|*{kube_version}*

|image:logos/crio.svg[CRI-O,width=200,height=70]
|link:https://cri-o.io/[]
^|*{crio_version}*

|image:logos/cilium.png[Cilium,width=200,height=70]
|link:https://cilium.io[]
^|*{cilium_version}*

|image:logos/etcd.svg[etcd,width=200,height=70]
|link:https://github.com/etcd-io/etcd[]
^|*{etcd_version}*

|image:logos/dex.png[dex,width=200,height=70]
|link:https://github.com/dexidp/dex[]
^|*?*

|image:logos/kured.png[Kured,width=80,height=70] Kured
|link:https://github.com/weaveworks/kured[]
^|*{kured_version}*

|Gangway
|link:https://github.com/heptiolabs/gangway[]
^|*?*
|===

=== Container Runtime environment

* runtime
* CRI-O
* orchestration
** etcd only on master nodes never on workers
* special considerations

=== Networking

* ingress and egress controllers
* ingress concepts
* egress concepts
* Overlay networking
* container networking interface
* services
* connections
* encryption
* networking policies (see security)

=== Storage

* Storage
* integrations
* defaults

=== Configuration Management and Orchestration

* caaspctl
* etcd
* cloud-init
* AutoYaST

=== Interfaces

==== API

* caaspctl api
* interaction

==== Integrations

* integration points with external services and applications

== Security

* security concepts

=== RBAC / PodSecurityPolicies

* user/role/group concepts

=== Networking Policies

=== Certificates

* type
* strength
* root CA
* cipher suites
* renewal
* default expiration

== Maintenance, Logging and Monitoring

=== Cluster Management
* how to add/remove/replace nodes -> caaspctl

=== Monitoring

* monitoring approach and considerations taken
** prometheus
** grafana
** containerized
** user defined dashboards

=== Logging

* logging approach and considerations taken
* logging formats and access points (API?)

=== Disaster Recovery

* disaster recovery concepts
* backup and restore concepts
* data retention and portability
